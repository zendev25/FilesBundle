$(document).ready(function(){            countPic();            $('.photo-upload').click(function(){            // Simulate a click on the file input button            // to show the file browser dialog            $(this).parents('.form-photo').find('input').click();        });                $('.drop-zone').on('dragover', function() {            $(this).addClass('hover');        });        $('.drop-zone').on('dragleave', function() {            $(this).removeClass('hover');        });                // Initialize the jQuery File Upload plugin        $('.form-manage-photos').each(function(i,elm){            $(elm).fileupload({                // This element will accept file drag/drop uploading                dropZone: $(elm).find('.drop-zone'),                // This function is called when a file is added to the queue;                // either via the browse button, or via drag/drop:                add: function (e, data) {    //                //récupère le champ via lequel l'utilisateur à uploadé son image    //                $    ////                log(data.paramName);                        //                $fieldUpload = $(e.currentTarget).parents('.form-photo').find('input.field-upload');    ////                $fieldUpload.show();    //                $dropZone = $(e.currentTarget).parents('.form-photo').find('.drop-zone');;                        $list = $(e.target).find('.form-photo-list');    //                            //                log('Zone')    //                log($(e.currentTarget).parent());    //                log($(e.currentTarget).parent());    //                log($(e.currentTarget).parents('.form-photo'));    //                log('List')    //                log($list);    //                                    var tpl = $('<li class="col-xs-3"><div class="working form-photo-thumb"><input type="text" value="0" data-width="48" data-height="48"'+                        ' data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p></div></li>');                    // Append the file name and file size                    tpl.find('p').text(data.files[0].name)                                 .append('<i>' + formatFileSize(data.files[0].size) + '</i>');                    //supprime la class hover sur la drop zone    //                $dropZone.removeClass('hover');                    //Si la drop-zone contient un data-room on set la valeur dans le champ like_CoreBundle_photo_roomId prévu à cette effet    //                if($fieldUpload.data('room')){    //                    val = $fieldUpload.data('room')    //                }else{    //                    val = 0;    //                }                    // Add the HTML to the UL element                    data.context = tpl.prependTo($list);                    // Initialize the knob plugin                    tpl.find('input').knob();                    // Listen for clicks on the cancel icon                    tpl.find('span').click(function(){                        if(tpl.hasClass('working')){                            jqXHR.abort();                        }                        tpl.fadeOut(function(){                            tpl.remove();                        });                    });                    // Automatically upload the file once it is added to the queue                    var jqXHR = data.submit();                },                progress: function(e, data){                    // Calculate the completion percentage of the upload                    var progress = parseInt(data.loaded / data.total * 100, 10);                    // Update the hidden input field and trigger a change                    // so that the jQuery knob plugin knows to update the dial                    data.context.find('input').val(progress).change();                    if(progress == 100){                        data.context.removeClass('working');                    }                },                done: function(e,data,f){                                       if(checkAjaxResponse(data.result)){                        //Si le form sur lequel l'image est ajouté est un formaulaire de chambre                        if(data.context.parents('.form-manage-photos').prop('name') != "parent-gallery"){                            //Ajoute l'image d'une gallerie enfant dans la gallerie enfant seulement si childGaleryInParentGalery est à TRUE dans le config.yml                            if( $('.form-manage-photos[name="parent-gallery"]').data('childgaleryinparentgalery') == '1'){                                //Ajoute l'image dans le form parent                                //L'ajout se fait dans le controller, le js est utilisé seulement pour l'affichage                                $('.form-manage-photos[name="parent-gallery"]').find('.form-photo-list li:last').before(data.result.element);                            }                                                    }                        //remplace le loader par l'image                        data.context.replaceWith(data.result.element);                        //initialise le bouton de suppression de l'image                        setRemoveButton($('.form-manage-photos[name="parent-gallery"]').find('.form-photo-list li:first .remove-photo'));                                                //Met à jour le nombre de photo par bloc                        countPic();                                                                    }else{                        data.context.remove();                    }                },                fail:function(e, data){                    // Something has gone wrong!                    data.context.remove();                    generateNotice('error', "Something has gone wrong");                }            });         });            // Prevent the default action when a file is dropped on the window            $(document).on('drop dragover', function (e) {                e.preventDefault();            });                        $('.form-photo-thumb .remove-photo').each(function(){            setRemoveButton($(this));        });        });function setRemoveButton(btn){    $(btn).click(function(){                $btn = $(this);        $.ajax({            url: $btn.data('url'),            type: 'POST',            success: function (response) {                if(checkAjaxResponse(response)){                    $btn.parents("li").fadeOut().remove();                    countPic();                }            }        })    });}    // Helper function that formats the file sizesfunction formatFileSize(bytes) {    if (typeof bytes !== 'number') {        return '';    }    if (bytes >= 1000000000) {        return (bytes / 1000000000).toFixed(2) + ' GB';    }    if (bytes >= 1000000) {        return (bytes / 1000000).toFixed(2) + ' MB';    }    return (bytes / 1000).toFixed(2) + ' KB';}function countPic(){    if( $('.form-manage-photos .total-photo').length){                $('.form-manage-photos').each(function(){            $(this).find('.total-photo').html($(this).find('.form-photo-list').find('.form-photo-thumb:not(.drop-zone)').length);        });    }else{        $('.total-photo').html($('.form-manage-photos[name="parent-gallery"]').find('.form-photo-list').find('.form-photo-thumb:not(.drop-zone)').length);    }}